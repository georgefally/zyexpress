<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>查看顾客信息</title>
    <script src="scripts/jquery/jquery.js"></script>
    <script src="bootstrap-3.3.6/js/bootstrap.js"></script>
    <link href="bootstrap-3.3.6/css/bootstrap.css" rel="stylesheet"/>
</head>
<body>
<div id="content"></div>
<div class="container">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#"><!--<img width="120" height="38" src="image/zyexpresswhite.png">--></a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
            </div> <!-- .nav-collapse -->
        </div> <!-- .container-fluid -->
    </nav>

    <div style="min-height: 16px;"></div>

    <form id="searchCustomerInfoForm" class="form-inline" method="post" onsubmit="return false;">

        <div class="row col-md-offset-2">
            <div class="form-group">
                <label>会员名称</label>
                <input type="text" name="cname" id="search_name" class="form-control" placeholder="搜索" value="">
            </div>

            <button class="btn btn-primary" id="search_btn" type="button">
                <span class="glyphicon glyphicon-search"></span> 查询
            </button>

            <button class="btn btn-primary" id="download_btn" type="button">
                <span class="glyphicon glyphicon-download-alt"></span> 下载
            </button>

        </div>
    </form>

    <div style="min-height: 16px;"></div>

    <div align="center">
        <table style="width:850px;margin:0px;margin-left:1px;" class="table table-condensed table-hover table-bordered">
            <tr class="info">
                <th style="width:50px;"><input type='checkbox' name='selectAll' id='selectAll' value='selectAll'></th>
                <th style="width:200px;">会员姓名</th>
                <th style="width:250px;">身份证号</th>
            </tr>
            <tbody id="dataTbody">
            </tbody>
        </table>
    </div>

</div>

</body>
</html>


<script>

$(function(){

	$("#search_btn").unbind("click").bind("click", function() {
	    $("input[name='selectAll']").prop("checked",false);
		search();
	});

    $("#download_btn").unbind("click").bind("click", function() {
	    download();
	});

	 //查询页面--绑定全选控件
    $("input[name='selectAll']").click(function(){
         //alert("selected");
         if($("input[name='selectAll']").prop("checked")==true){
             $("input[name='memIdGroup']").prop("checked",true);
         }else{
             $("input[name='memIdGroup']").prop("checked",false);
         }

    });

})

/**页面分页控件的使用方式;
 * page：int类型的值，默认给1
 */
function search() {
	var data = $("#searchCustomerInfoForm").serializeArray();//序列化表单
	$.ajax({
		type : "GET",
		contentType : "application/x-www-form-urlencoded",
		url : "restful/userIdCard/getUserId",
		dataType : "json",
		data : data||"",
		success : function(data) {
			if (data.length > 0) {
				var addHtml = "";
				//显示层绑定控件
				$.each(data, function(index, item) {
					addHtml = addHtml + "<tr>"
					        +"<td class='fontCenter2'><input type='checkbox' name='memIdGroup' value='"+item.idNumber+"'id='"+item.idNo+"'></td>"
							+ "<td class='fontCenter2' style='width:250px'>"
							+ item.userName + "</td>"
							+ "<td class='fontCenter2' style='width:200px'>"
							+ item.idNumber + "</td>"
							/*+ "<td class='fontCenter2' style='width:200px'>"
							+ "<a href='/pic/" + item.picF + ".jpg' download>下载</a> </td>"
							+ "<td class='fontCenter2' style='width:200px'>"
							+ "<a href='/pic/" + item.picS + ".jpg' download>下载</a> </td>"*/
						    + "</tr>";
				});
				//显示值在页面
				$("#dataTbody").empty().append(addHtml).trigger("create");

			} else {
			    $("#dataTbody").empty();
				alert("没有满足条件的值.....");
			}
		},
		error : function(data) {
		    $("#dataTbody").empty();
			alert("绑定事件的失败....");
		}
	});
}

function download(){

    var chkLen = $("input[name='memIdGroup']:checked").length;
    if(chkLen==0){
         $.com_modal_info.show({
             content:"请选择一条记录",
         });
    }else if (chkLen > 0){
        var obj = $("input[name='memIdGroup']:checked");
        var data = $("input[name='memIdGroup']:checked").serialize();

        //异步请求进行修改页面中的值
        $.ajax({
                type: "get",
                contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                url:"restful/userIdCard/downloadId",
                dataType:"json",
                data:(data=="" || data==null)?null:data,
                success:function(data){

                    if(data.head.rep_code=="200"){
                        $.com_modal_info.show({
                             content:"保存成功",
                             callback:function(){
                                 //$("#modifyMehodModal").modal("hide");//隐藏
                                 $.com_modal_wait.show({conent:"系统正在努力加载，请稍后..."});
                                    //刷新
                                 AddpageMemSearchPaging(1);
                                 $.com_modal_wait.close();
                             }
                         });

                    }else{
                        $.com_modal_info.show({
                            content:data.head.rep_message
                         });
                    }

                }
         });
    }

}

</script>