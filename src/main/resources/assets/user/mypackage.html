<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>中洋国际快递集团</title>
    <script src="../scripts/jquery/jquery.js"></script>
    <script src="../scripts/jquery/lightbox.js"></script>
    <script src="../scripts/jquery/easydialog.js"></script>
    <script src="../scripts/jquery/jquery.form.js"></script>
    <script src="../bootstrap-3.3.6/js/bootstrap.js"></script>
    <link href="../bootstrap-3.3.6/css/bootstrap.css" rel="stylesheet"/>
    <link href="../css/custom.css" rel="stylesheet"/>
    <link href="../css/register.css" rel="stylesheet"/>
    <link href="../css/account.css" rel="stylesheet"/>
    <link href="../css/loyout.css" rel="stylesheet"/>
    <link href="../css/lightbox.css" rel="stylesheet"/>
    <link href="../css/easydialog.css" rel="stylesheet"/>
    <link href="../css/checkout.css" rel="stylesheet"/>
    <style type="text/css">
        label {
        border: 0px;
        }

        .clear {
        clear: both;
        }

        .add-address {
        background-color: #3389AD;
        width: 120px;
        height: 36px;
        text-align: center;
        line-height: 36px;
        margin: 15px 0px 25px 0px;
        border: 0;
        border-radius: 3px;
        }

        .add-address a {
        width: 119px;
        height: 35px;
        display: block;
        }

        .add-address:hover {
        background: #006C99;
        color: #fff;
        }


        .batch {
        margin-bottom: 15px;
        height: 22px;
        }

        .batch div.floatLeft {
        float: left;
        height: 22px;
        line-height: 22px;
        text-align: center;
        margin-right: 15px;
        }

        .batch-delete {
        background: url(../Resources/Images/Address/defaultAddress.png) no-repeat;
        width: 75px;
        }

        .batch-delete a {
        width: 75px;
        height: 22px;
        display: block;
        }

        .user-address-table {
        width: 100%;
        border-collapse: collapse;
        text-align: center;
        }

        .user-address-table thead tr {
        background-color: rgb(208,232,255);
        }

        .user-address-table tr {
        height: 46px;
        }

        .user-address-table .operate-address {
        padding-top: 5px;
        }

        .user-address-table .operate-address div {
        float: left;
        margin-right: 5px;
        }

        .user-address-table .operate-address .check-address {
        background: url(../Resources/Images/Address/defaultAddress.png) no-repeat;
        width: 75px;
        }

        .user-address-table .operate-address .set-address {
        background: url(../Resources/Images/Address/setDefault.png) no-repeat;
        width: 75px;
        }

        .modal-footer {
        text-align: center;
        margin: 0px auto;
        }

        .modal-footer div {
        margin: 0px 28%;
        }

        .modal-footer div div {
        float: left;
        margin: 0px 5px;
        }

        .modal-footer .modal-footer-sava {
        background-color: #3389AD;
        width: 120px;
        height: 36px;
        text-align: center;
        line-height: 36px;
        border: 0;
        border-radius: 3px;
        }

        .modal-footer .modal-footer-sava:hover {
        background: #006C99;
        color: #fff;
        }

        .modal-footer .modal-footer-close {
        /*background-color:rgb(0,108,153);*/ /*url(../Images/Address/u24.png) no-repeat;*/
        width: 120px;
        height: 36px;
        text-align: center;
        line-height: 36px;
        border: 1px rgb(0,108,153) solid;
        border-radius: 3px;
        }

        .modal-footer div div a {
        width: 119px;
        height: 35px;
        display: block;
        }

        .modal-footer div div.modal-footer-close a {
        color: rgb(0,108,153);
        }

        /*新增收货地址*/
        .modal-header h4 {
        font-family: inherit;
        font-size: 20px;
        color: rgb(106, 106, 106);
        font-weight: 500;
        }

        .pop_con {
        margin: 0 auto;
        padding: 20px 20px 10px;
        }

        .pop_con .pop_table {
        width: 540px;
        }

        .pop_table td {
        padding: 5px;
        }

        .pop_table .tetRed {
        color: red;
        }

        .pop_table td.align_r {
        text-align: right;
        }


        .fontcolor77 {
        color: #777777;
        }

        .form_control {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 3px;
        font-size: 14px;
        height: 32px;
        line-height: 20px;
        padding: 0px 10px;
        width: 88%;
        }

        .slec_100 {
        border: 1px solid #ddd;
        height: 34px;
        width: 100%;
        border-radius: 3px;
        }

        .pop_table td.pd_r5 {
        padding: 0px;
        }

        .pop_table td.pd_r5 .add-card {
        /*background: url(../Images/Address/u24.png) no-repeat;*/
        width: 109px;
        height: 31px;
        text-align: center;
        line-height: 31px;
        margin: auto;
        border: 1px rgb(0,108,153) solid;
        border-radius: 3px;
        }

        .pop_table td.pd_r5 .add-card a {
        width: 108px;
        height: 30px;
        display: block;
        color: rgb(0,108,153);
        }

        .pop_table td.info {
        color: rgb(187,187,187);
        }

        .file {
        position: relative;
        top: -36px;
        left: auto;
        filter: alpha(opacity: 0);
        opacity: 0;
        width: 109px;
        height: 35px;
        cursor: pointer;
        }

        .popover {
        z-index: 10000;
        }

        input:checked + label {
        border-bottom: 0px;
        }
    </style>


</head>
<body>

<div class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="#"><img width="120" height="38" src="../image/zyexpresswhite.png"></a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="../index.html">首页</a></li>
                <li><a href="/hrExpress.html">人才招聘</a></li>
                <li><a href="/bizKnowledge.html">业务常识</a></li>
                <li><a href="#">联系我们</a></li>
                <li><a href="../index.html">退出</a></li>
                <!-- <li>
                     <form method="post" id="logoutform" action="/Account/Ajax/DoLogOff.ashx">
                         <a href="javascript:document.getElementById('logoutform').submit()">退出</a>
                     </form>
                 </li>-->
            </ul>
        </div> <!-- .nav-collapse -->
    </div>
</div>

<div style="height: 100%; width: 100%; padding-top: 100px; padding-bottom: 50px;">
    <div class="case">
        <div id="divleft">
            <div class="personal_l">
                <div style="padding-top: 5px; padding-bottom: 10px; text-align: center; font-size: 14px;">
                    <label id='username' style="color:#006C99;">账户名:</label>
                </div>
                <table style="width: 100%; border-collapse: collapse; text-align: center;" border="0">
                    <tr>
                        <td></td>
                        <td style="width: 100px;">
                        </td>
                        <td></td>
                    </tr>
                </table>
            </div>

            <ul id="navpage">
                <li data-type="7"><a href="./info.html">
                    <div>
                        <img src="../image/ico_person.png" alt="" />
                    </div>
                    <div>
                        &nbsp;我的资料
                    </div>
                </a>
                </li>
                <li data-type="1"><a href="#">
                    <div>
                        <img src="../image/ico_bag.png" alt="" />
                    </div>
                    <div>
                        &nbsp;我的包裹&nbsp;
                    </div>
                </a>
                </li>
                <li data-type="6"><a href="./address.html">
                    <div>
                        <img src="../image/ico_address.png" alt="" />
                    </div>
                    <div>&nbsp;我的收货地址</div>
                </a>
                </li>

            </ul>
        </div>
        <div id="divright">
            <div class="hdbx-content">
                <ul id="myTab" class="hdbx-tabs-nav">
                    <li class="hover">
                        <a href="#" style="color:#000000;">
                            <div style="font-size: 16px;"> 未支付包裹</div>
                        </a>
                        <span class="hdbx-tabs-nav-li-separator"></span>
                    </li>
                    <li>
                        <a href="./paidpackage.html" style="color:#000000;">
                            <div style="font-size: 16px;">已支付包裹</div>
                        </a>
                    </li>
                </ul>
            </div>

            <form class="form-inline" method="post" onsubmit="return false;">
                <div class="form-group">
                    <label>选择包裹</label>
                </div>
            </form>

            <table class="user-address-table table-condensed table-hover table-bordered">
                <thead>
                    <tr>
                        <th style="text-align:center;"><!--<input type='checkbox' name='selectAll' id='selectAll' value='selectAll'>--></th>
                        <th style="text-align:center;">包裹序号</th>
                        <th style="text-align:center;">账户名</th>
                        <th style="text-align:center;">重量-磅</th>
                        <th style="text-align:center;">物品品牌</th>
                        <th style="text-align:center;">物品名称</th>
                        <th style="text-align:center;">物品规格</th>
                        <th style="text-align:center;">物品数量</th>
                    </tr>
                </thead>
                <tbody id="dataTbodyPackage">
                </tbody>
            </table>

            <hr style="border: none; border-top: 2px dashed #D9F3FF; width: 100%;" />
            <input type="hidden" id="firlink" value="6" />

            <div class="form-group">
                <label>选择收件人身份证</label>
            </div>

            <table class="user-address-table table-condensed table-hover table-bordered">
                <thead>
                <tr>
                    <th style="text-align:center;width:5%;"></th>
                    <th style="text-align:center;width:20%;">姓名</th>
                    <th style="text-align:center;width:50%;">身份证号</th>
                    <th style="text-align:center;">审核状态</th>
                </tr>
                </thead>
                <tbody id="dataTbodyIdcard">
                </tbody>
            </table>

            <hr style="border: none; border-top: 2px dashed #D9F3FF; width: 100%;" />
            <input type="hidden"  value="6" />


            <div class="form-group">
                <label>选择收件人地址</label>
            </div>

            <table class="user-address-table table-condensed table-hover table-bordered">
                <thead>
                <tr>
                    <th style="text-align:center;width: 5%;"></th>
                    <th style="text-align:center;width: 20%;">姓名</th>
                    <th style="text-align:center;width: 20%;">手机</th>
                    <th style="text-align:center;width: 40%;">详细地址</th>
                    <th style="text-align:center;width: 15%;">邮编</th>
                </tr>
                </thead>
                <tbody id="dataTbodyAddress">
                </tbody>
            </table>

            <!--<form action="/Order/SubmitOrder.aspx" id="submitorderform" method="post" style="display: none;">-->
            <form id="submitorderform" method="post" >
                <!--<input type="hidden" name="c_choice" />
                <input type="hidden" name="c_centercode" value="" />-->
                <button id="pckgorder_btn" type="button" class="btn_submit_grey" style="background-color:#3389AD;color:#FFFFFF;background:#3389AD;">确认付款</button>
            </form>

        </div>
    </div>
</div>



<script>
    var login_token = sessionStorage.login_token;
    var login_user = sessionStorage.login_user;
    $("#username").html("账户名："+login_user);

    String.prototype.supplant = function (o) {
        return this.replace(/{([^{}]*)}/g, function (a, b) {
            var r = o[b];
            return typeof r === 'string' || typeof r === 'number' ? r : a;
        });
    };

     $(function () {

          $.ajax({
            type : "POST",
            contentType : "application/x-www-form-urlencoded",
            headers: {
                "Authorization": "Basic " + btoa(login_user + ":" + login_token)
            },
            url : "../restful/package/mysearch?login_user="+login_user,
            dataType : "json",
            data : {query_username:login_user},
            success : function(data) {
                var packages = data.payload;
                if (packages.length == 0) {
                    $("#dataTbodyPackage").empty();
                    easyDialog.open({
                        container: {
                            header: '没有结果',
                            content: "没有查询结果"
                        },
                        autoClose: 5000
                    });
                    return;
                }
                var row_template_withcbox = "<tr class='info'>"
                        + "<td class='fontCenter2'><input type='radio' name='packageIdCheckBox' value='{packageId}' id='{packageId}'></td>"
                        + "<td style='width:200px;'>ZY{packageId}CNY</td>"
                        + "<td style='width:250px;'>{accountName}</td>"
                        + "<td style='width:250px;'>{weight}</td>"
                        + "<td style='width:250px;'>{brand}</td>"
                        + "<td style='width:250px;'>{name}</td>"
                        + "<td style='width:250px;'>{specification}</td>"
                        + "<td style='width:250px;'>{quantity}</td>"
                        + "</tr>";
                var row_template_withoutcbox = "<tr class='info'>"
                        + "<td class='fontCenter2'></td>"
                        + "<td style='width:200px;'></td>"
                        + "<td style='width:250px;'></td>"
                        + "<td style='width:250px;'></td>"
                        + "<td style='width:250px;'>{brand}</td>"
                        + "<td style='width:250px;'>{name}</td>"
                        + "<td style='width:250px;'>{specification}</td>"
                        + "<td style='width:250px;'>{quantity}</td>"
                        + "</tr>";
                var addHtml = "";
                for (var i = 0; i < packages.length; i++) {
                    var pkg = packages[i];
                    for(var j=0; j< pkg.packageItems.length; j++){
                        packageItem = pkg.packageItems[j];
                        if(j == 0){
                            addHtml = addHtml + row_template_withcbox.supplant({
                                    packageId: pkg.packageId,
                                    accountName: pkg.accountName,
                                    weight: pkg.weight,
                                    brand: packageItem.brand,
                                    name: packageItem.name,
                                    specification: packageItem.specification,
                                    quantity: packageItem.quantity
                                });
                        }else{
                            addHtml = addHtml + row_template_withoutcbox.supplant({
                                    packageId: pkg.packageId,
                                    accountName: pkg.accountName,
                                    weight: pkg.weight,
                                    brand: packageItem.brand,
                                    name: packageItem.name,
                                    specification: packageItem.specification,
                                    quantity: packageItem.quantity
                                });
                        }
                    }
                    /*$.each(pkg.packageItems, function (index, packageItem) {
                        addHtml = addHtml + row_template.supplant({
                                    packageId: pkg.packageId,
                                    accountName: pkg.accountName,
                                    weight: pkg.weight,
                                    brand: packageItem.brand,
                                    name: packageItem.name,
                                    specification: packageItem.specification,
                                    quantity: packageItem.quantity
                                });
                    });*/
                    //显示值在页面
                    $("#dataTbodyPackage").empty().append(addHtml).trigger("create");
                }
            },
            error : function(jqXHR, textStatus, errorThrown) {
                if (jqXHR.status == 401) {
                    easyDialog.open({
                        container: {
                            header: '请重新登录',
                            content: '您尚未登录或已过期，请重新登录',
                            yesFn: function () {
                                window.location = "./login.html"
                            },
                            noFn: true
                        },
                        autoClose: 5000
                    });
                } else {
                    easyDialog.open({
                        container: {
                            header: '错误',
                            content: "服务器错误： " + jqXHR.responseJSON.payload
                        },
                        autoClose: 5000
                    });
                }
            }
        });



         $.ajax({
            type : "POST",
            contentType : "application/x-www-form-urlencoded",
            headers: {
                    "Authorization": "Basic " + btoa(login_user + ":" + login_token)
                },
            url : "../restful/idcard/query?login_user="+login_user,
            dataType : "json",
            data : {query_username:login_user},
            success : function(data) {
                if (data.payload.length > 0) {
                        var addHtml = "";
                        //显示层绑定控件
                        $.each(data.payload, function(index, item) {

                            addHtml = addHtml + "<tr>"
                                    +"<td style='text-align:center;width:5%;'><input type='radio' name='idCardBox' value='"+item.id+"' id='"+item.id+"'></td>"
                                    + "<td class='fontCenter2' style='width:250px'>"
                                    + item.idCardName + "</td>"
                                    + "<td class='fontCenter2' style='width:200px'>"
                                    + item.idCardNumber + "</td>"
                                    + "<td class='fontCenter2' style='width:200px'>"
                                    + item.approved + "</td>"
                                    + "</tr>";
                        });
                        //显示值在页面
                        $("#dataTbodyIdcard").empty().append(addHtml).trigger("create");
                    }else{
                        var addHtml = "";
                        $("#dataTbodyIdcard").empty().append(addHtml).trigger("create");
                    }
            },
            error : function(jqXHR, textStatus, errorThrown) {
                if (jqXHR.status == 401) {
                    easyDialog.open({
                        container: {
                            header: '请重新登录',
                            content: '您尚未登录或已过期，请重新登录',
                            yesFn: function () {
                                window.location = "../index.html"
                            },
                            noFn: true
                        },
                        autoClose: 5000
                    });
                } else {
                    easyDialog.open({
                        container: {
                            header: '错误',
                            content: "服务器错误： " + jqXHR.responseJSON.payload
                        },
                        autoClose: 5000
                    });
                }
            }
        });


         $.ajax({
                type : "POST",
                contentType : "application/x-www-form-urlencoded",
                headers: {
                    "Authorization": "Basic " + btoa(login_user + ":" + login_token)
                },
                url : "../restful/address/query?login_username="+login_user,
                dataType : "json",
                success : function(data) {
                    //alert("User info: " + JSON.stringify(data.payload));
                    if (data.payload.length > 0) {
                        var addHtml = "";
                        //显示层绑定控件
                        $.each(data.payload, function(index, item) {
                            var defaultAddress = "";

                            addHtml = addHtml + "<tr>"
                                    +"<td style='text-align:center;width: 5%;'><input type='radio' name='addressBox' value='"+item.id+"' id='"+item.id+"'></td>"
                                    + "<td class='fontCenter2' style='width:250px'>"
                                    + item.receiverName + "</td>"
                                    + "<td class='fontCenter2' style='width:200px'>"
                                    + item.phoneNumber + "</td>"
                                    + "<td class='fontCenter2' style='width:200px'>"
                                    + item.address + "</td>"
                                    + "<td class='fontCenter2' style='width:200px'>"
                                    + item.postcode + "</td>"
                                    + "</tr>";
                        });
                        //显示值在页面
                        $("#dataTbodyAddress").empty().append(addHtml).trigger("create");
                    }else{
                        var addHtml = "";
                         $("#dataTbodyAddress").empty().append(addHtml).trigger("create");
                    }

                },
                error : function(jqXHR, textStatus, errorThrown) {
                    if (jqXHR.status == 401) {
                        easyDialog.open({
                            container: {
                                header: '请重新登录',
                                content: '您尚未登录或已过期，请重新登录',
                                yesFn: function () {
                                    window.location = "../index.html"
                                },
                                noFn: true
                            },
                            autoClose: 5000
                        });
                    } else {
                        easyDialog.open({
                            container: {
                                header: '错误',
                                content: "服务器错误： " + jqXHR.responseJSON.payload
                            },
                            autoClose: 5000
                        });
                    }
                }
            });

         $("#pckgorder_btn").unbind("click").bind("click", function() {
             var pckgCheck=$('input:radio[name="packageIdCheckBox"]:checked').val()||'';
             var addressCheck=$('input:radio[name="addressBox"]:checked').val()||'';
             var idcardCheck=$('input:radio[name="idCardBox"]:checked').val()||'';
             var info = "请至少选择";
             if(pckgCheck == ""||addressCheck==""||idcardCheck==""){
                easyDialog.open({
                    container: {
                        header : '温馨提示',
                        content: "请选择一个包裹信息、身份证信息以及地址信息。",
                        yesFn: true
                    },
                    fixed: false,
                    autoClose: 10000
                });
             }else{
                 $.ajax({
                    type : "POST",
                    contentType : "application/x-www-form-urlencoded",
                    headers: {
                        "Authorization": "Basic " + btoa(login_user + ":" + login_token)
                    },
                    url : "../restful/package/pay?login_username="+login_user,
                    data : {pckgid:pckgCheck,addressid:addressCheck,idcardid:idcardCheck},
                    dataType : "json",
                    success : function(data) {
                        easyDialog.open({
                                container: {
                                    header: '温馨提示',
                                    content: '支付成功',
                                    yesFn: function () {
                                       window.location.reload();
                                    },
                                    noFn: true
                                },
                                autoClose: 10000
                        });
                        //window.location.reload();
                    },
                    error : function(jqXHR, textStatus, errorThrown) {
                        if (jqXHR.status == 401) {
                            easyDialog.open({
                                container: {
                                    header: '请重新登录',
                                    content: '您尚未登录或已过期，请重新登录',
                                    yesFn: function () {
                                        window.location = "../index.html"
                                    },
                                    noFn: true
                                },
                                autoClose: 5000
                            });
                        } else {
                            easyDialog.open({
                                container: {
                                    header: '错误',
                                    content: "服务器错误： " + jqXHR.responseJSON.payload
                                },
                                autoClose: 5000
                            });
                        }
                    }
                });
             }

         });

     });

</script>
</body>
</html>
