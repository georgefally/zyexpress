<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>会员登录</title>
    <script src="../scripts/jquery/jquery.js"></script>
    <script src="../bootstrap-3.3.6/js/bootstrap.js"></script>
    <link href="../bootstrap-3.3.6/css/bootstrap.css" rel="stylesheet"/>
    <link href="../css/custom.css" rel="stylesheet"/>
</head>
<body>

<form id="userRegisterForm" class="form-inline" method="post" onsubmit="return false;">
    <div class="row col-md-offset-2">
        <div class="form-group">
            <label>会员注册</label>
            <input type="text" name="register_username" id="register_username" class="form-control" placeholder="用户名" value="">
            <input type="password" name="register_password" id="register_password" class="form-control" value="">
            <input type="submit" name="register_submit" id="register_submit" class="form-control" value="注册">
        </div>
    </div>
</form>

<form id="userLoginForm" class="form-inline" method="post" onsubmit="return false;">
    <div class="row col-md-offset-2">
        <div class="form-group">
            <label>会员登录</label>
            <input type="text" name="login_username" id="login_username" class="form-control" placeholder="用户名" value="">
            <input type="password" name="login_password" id="login_password" class="form-control" value="">
            <input type="submit" name="login_submit" id="login_submit" class="form-control" value="登录">
        </div>
    </div>
</form>

<script>

    $("#register_submit").unbind("click").bind("click", function() {
        var data = $("#userRegisterForm").serializeArray();//序列化表单
        $.ajax({
            type : "PUT",
            contentType : "application/x-www-form-urlencoded",
            url : "../restful/user",
            dataType : "json",
            data : data || "",
            success : function(data) {
                var user = data.payload;
                alert("Successfully registered, user: " + user);
            },
            error : function(jqXHR, textStatus, errorThrown) {
                alert("Failed to register, error: " + jqXHR.responseText);
            }
        });
    });

    $("#login_submit").unbind("click").bind("click", function() {
        var user = $("#login_username").val();
        var data = $("#userLoginForm").serializeArray();//序列化表单
        $.ajax({
            type : "POST",
            contentType : "application/x-www-form-urlencoded",
            url : "../restful/user/login",
            dataType : "json",
            data : data || "",
            success : function(data) {
                var login_user = user;
                var login_token = data.payload;
                sessionStorage.login_user = user;
                sessionStorage.login_token = data.payload;
                alert("Login submitted, user=" + login_user + ", token=" + login_token);
                window.location = "./index.html"
            },
            error : function(jqXHR, textStatus, errorThrown) {
                alert("Login failed, error: " + jqXHR.responseText);
            }
        });
    });

</script>

</body>
</html>
